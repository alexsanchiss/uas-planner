generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model machine {
  id         Int          @id @default(autoincrement())
  name       String       @db.Text
  status     String       @db.Text
  flightPlans flightPlan[]
}

model folder {
  id             Int          @id @default(autoincrement())
  name           String       @db.VarChar(255)
  userId         Int
  createdAt      DateTime?    @default(now()) @db.DateTime(0)
  minScheduledAt DateTime?
  maxScheduledAt DateTime?
  flightPlans    flightPlan[]
  user           user         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "folder_ibfk_1")

  @@index([userId], map: "userId")
}

model flightPlan {
  id                  Int      @id @default(autoincrement())
  customName          String
  status              String
  fileContent         String
  csvResult           Int?     // IMPORTANT: This is a BOOLEAN FLAG (0 or 1), NOT an ID!
                               // The csvResult table has a 1:1 relationship via the SAME ID
                               // Usage: if (flightPlan.csvResult) { fetch csvResult where id = flightPlan.id }
  createdAt           DateTime @default(now())
  machineAssignedId   Int?
  userId              Int
  folderId            Int?
  folder              folder?  @relation(fields: [folderId], references: [id])
  uplan                 Json?    // JSON calculado
  authorizationStatus   String   @default("sin autorización") // Estado de autorización
  authorizationMessage  Json?    // Mensaje de autorización (JSON, puede ser largo)
  scheduledAt           DateTime? // <-- Nueva línea: fecha y hora de vuelo (opcional)
  externalResponseNumber String?
  geoawarenessData  Json?    // Respuesta del servicio de geoawareness (GeoJSON)
}

model csvResult {
  id        Int       @id @default(autoincrement())
  csvResult String?   @db.LongText
  createdAt DateTime? @default(now()) @db.DateTime(0)

  @@map("csvresult")
}

model flightPlan {
  id                     Int       @id @default(autoincrement())
  customName             String    @db.Text
  status                 String    @db.Text
  fileContent            String?   @db.MediumText
  csvResult              Int?      @db.SmallInt
  createdAt              DateTime? @default(now()) @db.Timestamp(0)
  userId                 Int?
  machineAssignedId      Int?
  folderId               Int?
  uplan                  String?   @db.LongText
  authorizationStatus    String    @default("sin autorización") @db.VarChar(32)
  authorizationMessage   String?   @db.LongText
  scheduledAt            DateTime?
  externalResponseNumber String?   @db.VarChar(255)
  geoawarenessData       Json?
  user                   user?     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "flightplan_ibfk_1")
  machine                machine?  @relation(fields: [machineAssignedId], references: [id], onUpdate: NoAction, map: "flightplan_ibfk_2")
  folder                 folder?   @relation(fields: [folderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "flightplan_ibfk_3")

  @@index([folderId], map: "folderId")
  @@index([machineAssignedId], map: "machineAssignedId")
  @@index([userId], map: "userId")
  @@map("flightplan")
}
